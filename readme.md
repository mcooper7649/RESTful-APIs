## Build Your Own RESTful API from Scratch
---

[Robo3T download](https://robomongo.org/)
[Starter Code](https://github.com/londonappbrewery/Build-Your-Own-RESTful-API)

1. What is REST?
    - Representational State Transfer
    - Client makes a Request to the Server
    - VIA HTTP Request 
    - In our Callbacks | app.get(function(req, res){})  // The req is the request to the server
    - FTP is another common request you will see  
    - HTTPS is a Secure Request
    - If a Client makes a Valid request, then the Server should respond with the requested data, such as webpage or code.
    - RES is the RESPONSE we get back from the server
    - The RES can be processed on the serverside, like maybe a calculator app 
    - Sometimes the Server needs relevant data from the DB to fulfull the req
    - Sometimes res needs to be both data from the DB and to be processed serverside before being sent back to the client
    - The Server is limited in what it can do
    - APIs allows our Server to offer our client a wide variety of DATA

2. Rest is an Architectural Style
    - Similiar to buildings around the world with different Architecture
    - Rest is an Architectural Style for creating API's
    - Other APIs styles include SOAP, GraphQL, Falcor and many others
    - REST is the GOLD standard for Web APIs


3. REST was originally created to standardize the way the WEB APIs were created
    - This includes tons of rules to make it RESTful
    - Use HTTP Request Verbs
        - GET 
            - Similiar to Read in CRUD
            - app.get (We are familiar with app.get as a get request)
        - POST
            - Similiar to Create in CRUD
            - app.post (We are familiar with app.post as a post request)
        - PUT & PATCH (PATCH is new)
            - Both UPDATE like CRUD
            - app.put or app.patch with the callback
            - app.put will replace the current entry and replace it with a new document
            - app.patch will only send the piece of data that needs to be updated
        - DELETE
            - Similiar to the Delete in CRUD
            - app.delete with callback
    -  Use a Specific Pattern of Routes/Endpoint URLs


4. Creating a DB with Robo 3T
    - Before we get started, lets setup Robo 3T a GUI for mongoDB
    - localhost is the address
    - 27017 is the port
    - If network is unreachable we need to start the mongodb server | mongod
    - This allows us to create manage DB from GUI
    - Right Click on New Connection and Create a DB | WikiDB
    - Right Click on Collections and Click Create Collection  
        - Naming Convention for MongoDB Collections should be lowercase and plural
        - articles for our WikiDB
    - Right Click articles and Click View Documents and you will see the MongoDB code ran in the script bar above
        - db.getCollection('articles').find({})
        - you can use this confirm your code works before you add to your applications

5. Create a Document with Robo 3t
    - Right Click Articles and Click Insert Document 
        - Same as Create in CRUD
    - This Document will have two fields
        - Title: "REST"
        - Content: "Rest is short for Respresentational State Transfer, it's an architectural style for designing API's."
    - Right Click articles > View Documents
        - You should see our REST Document we just inserted
        - You will also see the ID that was generated by the creation of the document
        - You can right click and edit any properties of the document if you need to 
        - Add the 3 examples below to complete the next step

```
{
    "_id" : ObjectId("5c139771d79ac8eac11e754a"),
    "title" : "API",
    "content" : "API stands for Application Programming Interface. It is a set of subroutine definitions, communication protocols, and tools for building software. In general terms, it is a set of clearly defined methods of communication among various components. A good API makes it easier to develop a computer program by providing all the building blocks, which are then put together by the programmer."
}


{
    "_id" : ObjectId("5c1398aad79ac8eac11e7561"),
    "title" : "Bootstrap",
    "content" : "This is a framework developed by Twitter that contains pre-made front-end templates for web design"
}


{
    "_id" : ObjectId("5c1398ecd79ac8eac11e7567"),
    "title" : "DOM",
    "content" : "The Document Object Model is like an API for interacting with our HTML"
}

```

6.  CodeWiki-API

    - Create a new Directory called WIKI-API
    - Init NPM
    - Install body-parser, mongoose, ejs, and express
    - Create a file called, app.js
    - Inside app.js add server code (Write/Copy)
        - This incldues requiring code and setting up mongoose
    - Setup MongoDB
        - DB name should be wikiDB
        - Collection name is articles 
        - Document has 2 fields: title and content


7. Find an Article (GET)
    - using app.get request
        - Submit a find, to find all articles
        - go to localhost:3000/articles to trigger GET request and see the console log of the results
        - add res.send(results) and now the page will return the results like we've seen with APIs
```
app.get("/articles", function (req, res) {
    Article.find({}, function (err, results) {
        if (!err){
        console.log(results)
        res.send(results)
    }else{
        console.log(err)
        res.send(err)
    }})
})
```

8. Create a new Article (POST)

    - This one is tricky because the client needs to send data to the server and we don't have a frontend
    - We can use a TOOL called PostMAN to send and test our API without needing a frontend at all
    - Create the app.post with "/articles" as per the POST methodology
        - add console.log req.body title and content
    - Make a post on Postman and you should see the logs of the post
    - Cool! Now we need it to save to the DB though
    - Declare new const newArticle and use new keyword to assign to Article Model.
    - add req.body title and content for required fields
    - call save method on newArticle
    - Test by Submitting a post via postman again
    - Confirm via get request or robo3t
    - Add data validation so postman doesn't hange
        - Inside the save method we can add a callback
   

```
app.post("/articles", function (req, res) {
console.log(req.body.title);
console.log(req.body.content);


const newArticle = new Article({
    title: req.body.title,
    content: req.body.content
});

newArticle.save(function(err){
    if (!err){
        res.send("Sucessfully added a new article")
    } else {
        res.send(err)
    }
});

});
```


9. Delete All articles (Delete)
---

- Declare app.delete with a route and callback

```
app.delete("/articles", function(req, res){
    Article.deleteMany(function (err){
        if (!err){
            res.send("Delete Successful")
        } else {
            res.send(err)
        }
    })
})

```

10. Chainable Route Handlers
---
- app.route()
    - This allows you to create chainable route handlers to help reduce redundancy and typos. This is a feature of Expresss
    -

```

app.route("/articles")

.get(function (req, res) {
    Article.find({}, function (err, results) {
        if (!err){
        console.log(results)
        res.send(results)
    }else{
        console.log(err)
        res.send(err)
    }})
})

.post(function (req, res) {
console.log(req.body.title);
console.log(req.body.content);


const newArticle = new Article({
    title: req.body.title,
    content: req.body.content
});

newArticle.save(function(err){
    if (!err){
        res.send("Sucessfully added a new article")
    } else {
        res.send(err)
    }
});

})

.delete(function(req, res){
    Article.deleteMany(function (err){
        if (!err){
            res.send("Delete Successful")
        } else {
            res.send(err)
        }
    })
})

```

11. Get request Challenge
---

- Create a get request, using the app.route chaining method we just learned.


```

app.route("/articles")

.get(function (req, res) {
    
})

```

12. Getting a Single Article
---

- Route parameters are named URL segments that are used to capture the values specified at the their position in the URL. The captured values are populated in the req.params object

Route path: /users/:userId/books/:bookId
Request URL: http://localhost:3000/users/34/books/8989
req.params: {"usersId": "34", "bookId": "909"}


```
app.get('/users/:userId/books/:bookId', function(req,res){
    res.send(req.params)
})

```

```
app.route("/articles/:articleTitle")

.get(function (req, res) {
    Article.findOne({title: req.params.articleTitle }, function (err, foundArticle) {
        if (foundArticle){
            res.send(foundArticle)
        } else {
            res.send("No Articles Found")
        }
    })
});
```


12. Put Request on a Specific Article
---

- This is updates a specific article
- We can chain our put method onto our app.route but we must remember to remove the ; from the get method or the chain will break
- Remember a put request will destroy and replace a document, if ALL the previous fields weren't put in the req.body, those fields will be empty.


```
.put(function (req, res){
    Article.updateOne(
        {title: req.params.articleTitle},
        {title: req.body.title, content: req.body.content},
        {overwrite:true}, function (err) {
        if (!err){
            res.send("Successfully Updated")
        }
    })
});
```


12. Patch Request on a Specific Article
---
- This is updates a specific article
- Patch allows us to update a single property without actually replacing the document like put does.
- We can chain our patch method onto our app.route but we must remember to remove the ; from the get method or the chain will break
- {overwrite:true} will be removed as this interferes with patch
- {$set: updates} will replace overwrite and it lets us specify what the fields and value changes are
- {$set: {title: "Chuck Norris", content: "Baddest MOFO alive"}}
    - This example shows how to use set to specify data properties
- $set: req.body // This allows us to pull the body parsed data the user submits to update


```
.patch(function (req, res) {



  Article.updateOne(
    {title: req.params.articleTitle}, 
    {$set: req.body},
    function(err){
        if(!err){
            res.send("Successfully Updated")
        } else {
            res.send(err)
        }
    }
  )  
});
```

13. Delete a Specific Article
---

- We can chain the delete method and use the express method deleteOne on the Article Model
- Using the requests params we can search for the title
- Make sure to add data validation

```
.delete(function (req, res) {
    Article.deleteOne(
        {title: req.params.articleTitle},function (err) {
            if (!err){
                res.send("Successfully Deleted Article")
            } else {
                res.send(err)
            }
        }

        )
});
```